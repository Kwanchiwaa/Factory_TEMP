<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Real-Time Sensor Dashboard</title>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    canvas { max-width: 400px; }
  </style>
</head>
<body>
  <h1>Real-Time Sensor Dashboard</h1>

  <p>Temperature: <span id="temperature">N/A</span> °C</p>
  <canvas id="tempChart"></canvas>

  <p>Humidity: <span id="humidity">N/A</span> %</p>
  <canvas id="humChart"></canvas>

  <p>PM2.5: <span id="pm25">N/A</span> µg/m³</p>
  <canvas id="pmChart"></canvas>

  <script>
    var socket = io.connect();

    // ChartJS chart setup
    const tempCtx = document.getElementById('tempChart').getContext('2d');
    const tempChart = new Chart(tempCtx, {
      type: 'doughnut',
      data: {
        labels: ['Temperature'],
        datasets: [{
          data: [0, 100],
          backgroundColor: ['#ff6384', '#e0e0e0'],
        }]
      }
    });

    const humCtx = document.getElementById('humChart').getContext('2d');
    const humChart = new Chart(humCtx, {
      type: 'doughnut',
      data: {
        labels: ['Humidity'],
        datasets: [{
          data: [0, 100],
          backgroundColor: ['#36a2eb', '#e0e0e0'],
        }]
      }
    });

    const pmCtx = document.getElementById('pmChart').getContext('2d');
    const pmChart = new Chart(pmCtx, {
      type: 'bar',
      data: {
        labels: ['PM2.5'],
        datasets: [{
          label: 'PM2.5 (µg/m³)',
          data: [0],
          backgroundColor: ['#ffce56']
        }]
      }
    });

    // Update data from server
    socket.on('sensor_data', function(data) {
      console.log(data);
      if (data.topic === 'sensor/temperature') {
        document.getElementById('temperature').innerText = data.value;
        tempChart.data.datasets[0].data[0] = parseFloat(data.value);
        tempChart.data.datasets[0].data[1] = 100 - parseFloat(data.value);
        tempChart.update();
      }
      if (data.topic === 'sensor/humidity') {
        document.getElementById('humidity').innerText = data.value;
        humChart.data.datasets[0].data[0] = parseFloat(data.value);
        humChart.data.datasets[0].data[1] = 100 - parseFloat(data.value);
        humChart.update();
      }
      if (data.topic === 'sensor/pm25') {
        document.getElementById('pm25').innerText = data.value;
        pmChart.data.datasets[0].data[0] = parseFloat(data.value);
        pmChart.update();
      }
    });
  </script>
</body>
</html>
