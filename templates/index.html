<!DOCTYPE html>
<html>
<head>
  <title>Real-time Sensor Dashboard</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f9f9f9; }
    canvas { max-width: 600px; margin: 20px auto; }
  </style>
</head>
<body>
  <h1>Real-time Sensor Dashboard</h1>
  
  <canvas id="tempChart"></canvas>
  <canvas id="humChart"></canvas>
  <canvas id="pmChart"></canvas>

  <script>
    const socket = io();

    // Chart setup
    const tempCtx = document.getElementById('tempChart').getContext('2d');
    const humCtx = document.getElementById('humChart').getContext('2d');
    const pmCtx = document.getElementById('pmChart').getContext('2d');

    const tempData = { labels: [], datasets: [{ label: 'Temperature (°C)', data: [], borderColor: 'red', fill: false }] };
    const humData = { labels: [], datasets: [{ label: 'Humidity (%)', data: [], borderColor: 'blue', fill: false }] };
    const pmData = { labels: [], datasets: [{ label: 'PM2.5 (μg/m³)', data: [], borderColor: 'green', fill: false }] };

    const tempChart = new Chart(tempCtx, { type: 'line', data: tempData });
    const humChart = new Chart(humCtx, { type: 'line', data: humData });
    const pmChart = new Chart(pmCtx, { type: 'line', data: pmData });

    // เมื่อได้รับข้อมูลจาก server
    socket.on('sensor_data', function(data) {
      const timestamp = new Date().toLocaleTimeString();

      // Update temp
      tempData.labels.push(timestamp);
      tempData.datasets[0].data.push(data.temperature);
      if (tempData.labels.length > 10) {
        tempData.labels.shift();
        tempData.datasets[0].data.shift();
      }
      tempChart.update();

      // Update hum
      humData.labels.push(timestamp);
      humData.datasets[0].data.push(data.humidity);
      if (humData.labels.length > 10) {
        humData.labels.shift();
        humData.datasets[0].data.shift();
      }
      humChart.update();

      // Update pm2.5
      pmData.labels.push(timestamp);
      pmData.datasets[0].data.push(data.pm25);
      if (pmData.labels.length > 10) {
        pmData.labels.shift();
        pmData.datasets[0].data.shift();
      }
      pmChart.update();
    });
  </script>
</body>
</html>
