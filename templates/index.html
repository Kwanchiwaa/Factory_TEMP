<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Real-Time Sensor Dashboard</title>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.3.5/justgage.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      background: #f0f0f0;
    }
    h1 { margin: 20px 0; }
    .gauges {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .gauge {
      width: 180px;
      height: 140px;
    }
    canvas {
      max-width: 600px;
      margin: 20px auto;
      background: #fff;
      border-radius: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>Real-Time Sensor Dashboard</h1>

  <div class="gauges">
    <div class="gauge" id="tempGauge"></div>
    <div class="gauge" id="humiGauge"></div>
    <div class="gauge" id="pm25Gauge"></div>
  </div>

  <canvas id="lineChart"></canvas>

  <script>
    var socket = io.connect();

    // กำหนดข้อมูลสำหรับกราฟเส้น
    const labels = [];
    const tempData = [];
    const humiData = [];
    const pm25Data = [];

    const ctx = document.getElementById('lineChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          { label: 'Temperature (°C)', borderColor: 'red', data: tempData, tension: 0.3 },
          { label: 'Humidity (%)', borderColor: 'blue', data: humiData, tension: 0.3 },
          { label: 'PM2.5 (µg/m³)', borderColor: 'green', data: pm25Data, tension: 0.3 }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // สร้างเกจวัด
    var tempGauge = new JustGage({ id: "tempGauge", min: 0, max: 50, value: 0, label: "Temp (°C)" });
    var humiGauge = new JustGage({ id: "humiGauge", min: 0, max: 100, value: 0, label: "Humidity (%)" });
    var pm25Gauge = new JustGage({ id: "pm25Gauge", min: 0, max: 500, value: 0, label: "PM2.5 (µg/m³)" });

    // รับข้อมูลจาก Server
    socket.on('sensor_data', function(data) {
      console.log(data);

      const timeLabel = new Date().toLocaleTimeString();
      if (labels.length > 20) {
        labels.shift();
        tempData.shift();
        humiData.shift();
        pm25Data.shift();
      }
      labels.push(timeLabel);

      if (data.topic === 'sensor/temperature') {
        tempData.push(parseFloat(data.value));
        tempGauge.refresh(data.value);
      } else if (data.topic === 'sensor/humidity') {
        humiData.push(parseFloat(data.value));
        humiGauge.refresh(data.value);
      } else if (data.topic === 'sensor/pm25') {
        pm25Data.push(parseFloat(data.value));
        pm25Gauge.refresh(data.value);
      }

      chart.update();
    });
  </script>
</body>
</html>

